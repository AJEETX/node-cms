extends layout

block content
    .container
        each content in contents
            h2 
                a(href='/content/#{content._id}')
                    | #{content.title}
            p
                if (content.author)
                    strong
                        | #{content.author.name} 
                | 发布于 
                | #{moment(content.created).format('LLL')}
            .content
                | !{md(content.content)}
            .meta
                | 评论数
                strong #{content.comments.length}
                | 访问量
                strong #{content.visits}
        .text-center
            if (pageInfo && pageInfo.totalPage > 1)
                include ./page
                +pagination(pageInfo)
block foot-js
    script.
        var token = '#{token}';
        $(document).on('click', '.J_svar $this = $(this);
            var $item = $this.closest('.comment');
            var $list = $item.find('.J_list');
            var $textarea = $item.find('.J_textarea');
            var cid = $item.attr('data-from');
            var content = $textarea.val();
            //console.log(cid, content);
            var data = {
                from: cid,
                content: content,
                _csrf: token
            };
            $.post('/comment/add', data, function(json) {
                console.log(json);
                if(json.success === true) {
                    var $li = $('<li>' + json.data.content + '</li>');
                    $list.append($li);
                    $textarea.val('');
                }
            });ubmit', function() {
            
        });
        
        
                
